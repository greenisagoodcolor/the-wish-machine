<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>The Wish Machine - Where Consciousness Shapes Quantum Reality</title>
    <meta name="title" content="The Wish Machine - Measure Your Consciousness Influence">
    <meta name="description" content="Test if your consciousness can influence quantum reality. Make a wish, observe 1000 quantum collapse simulations, and see if your intention shifts probability distributions. Real quantum mechanics meets consciousness research.">
    <meta name="keywords" content="quantum consciousness, manifestation, quantum mechanics, observer effect, intention, consciousness research, quantum collapse, bimodal distribution, wish manifestation">
    <meta name="author" content="The Wish Machine">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://thewishmachine.up.railway.app/">

    <!-- Open Graph / Facebook / LinkedIn -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thewishmachine.up.railway.app/">
    <meta property="og:title" content="The Wish Machine - Can Consciousness Influence Quantum Reality?">
    <meta property="og:description" content="Make a wish and watch 1000 quantum simulations collapse. See if your focused intention shifts the probability distribution from 50% baseline to 95% manifestation. Real quantum mechanics meets consciousness research.">
    <meta property="og:image" content="https://thewishmachine.up.railway.app/static/og-image.png">
    <meta property="og:site_name" content="The Wish Machine">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://thewishmachine.up.railway.app/">
    <meta name="twitter:title" content="The Wish Machine - Consciousness Meets Quantum Mechanics">
    <meta name="twitter:description" content="Test if your consciousness influences reality. Make a wish, observe 1000 quantum collapses, see measurable results. Join the experiment.">
    <meta name="twitter:image" content="https://thewishmachine.up.railway.app/static/og-image.png">

    <!-- Mobile & PWA -->
    <meta name="theme-color" content="#8B5CF6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wish Machine">

    <!-- Performance & Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&family=Inter:wght@300;400;600&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8B5CF6;
            --secondary: #EC4899;
            --accent: #F093FB;
            --accent2: #F5576C;
            --dark: #0F0F23;
            --light: #F8F9FA;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #0F0F23 0%, #1a1a3e 50%, #0F0F23 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            position: relative;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 35, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .nav.scrolled {
            background: rgba(15, 15, 35, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: white;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .nav-brand:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            color: white;
        }

        .nav-link.btn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            padding: 8px 20px;
            border-radius: 8px;
            color: white;
        }

        .nav-link.btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(240, 147, 251, 0.4);
        }

        .user-info {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 100px 20px 40px;
            position: relative;
            z-index: 1;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 80px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            font-size: 72px;
            margin-bottom: 24px;
            /* No animation - minimal design */
        }

        /* New hero text hierarchy - modern, breathing spacing */
        .hero-brand {
            font-family: var(--font-sans);
            font-size: 56px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 32px;
            letter-spacing: -0.03em;
            line-height: 1.1;
        }

        .hero-value-prop {
            font-size: 24px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.5;
            letter-spacing: -0.01em;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-cta-text {
            font-size: 20px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 48px;
            line-height: 1.4;
        }

        .hero-cta-text strong {
            font-weight: 600;
        }

        /* Legacy styles for backward compatibility */
        h1 {
            font-family: var(--font-sans);
            font-size: var(--text-3xl);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-3);
            letter-spacing: var(--tracking-tight);
            line-height: var(--leading-tight);
        }

        .tagline {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: var(--tracking-normal);
            max-width: 650px;
            margin: 0 auto;
            line-height: var(--leading-normal);
        }

        .hero-description {
            font-size: 18px;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.85);
            max-width: 700px;
            margin: 24px auto;
            text-align: center;
        }

        .hero-description:first-of-type {
            margin-top: 40px;
        }

        .hero-tagline-secondary {
            font-size: var(--text-base);
            line-height: var(--leading-relaxed);
            color: var(--text-secondary);
            max-width: 650px;
            margin: var(--space-3) auto 0;
        }

        .hero-tagline-secondary strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        p {
            font-size: var(--text-base);
            line-height: var(--leading-relaxed);
            color: var(--text-secondary);
        }

        /* Hero enhancements */
        .hero-particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            opacity: 0.4;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-description strong {
            color: white;
            font-weight: 600;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Social proof bar */
        .social-proof-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 32px auto 16px;
            padding: 12px 24px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 100px;
            max-width: fit-content;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.85);
        }

        #wish-count {
            font-weight: 700;
            color: #c084fc;
            font-size: 15px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.1);
            }
        }

        /* CTA hint with animated arrow */
        .hero-cta-hint {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            margin-top: 56px;
            padding-bottom: 24px;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.75);
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .arrow-down {
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(8px); }
        }

        /* Card */
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 48px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.8s ease-out;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 32px 90px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .wish-input {
            width: 100%;
            padding: 24px;
            font-size: 18px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.08);
            color: white;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            resize: vertical;
            min-height: 140px;
            margin-bottom: 36px;
            line-height: 1.6;
        }

        .wish-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), 0 0 30px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        .wish-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Intensity Slider */
        .intensity-slider {
            margin: 30px 0;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.15);
            outline: none;
            -webkit-appearance: none;
            margin: 20px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            cursor: pointer;
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.6);
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            cursor: pointer;
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.6);
            border: none;
        }

        .intensity-value {
            text-align: center;
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-top: 10px;
        }

        .make-wish-btn {
            width: 100%;
            padding: 26px;
            font-size: 20px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            border: none;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: 0.5px;
            box-shadow: 0 12px 35px rgba(240, 147, 251, 0.35);
            position: relative;
            overflow: hidden;
        }

        .make-wish-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .make-wish-btn:hover::before {
            left: 100%;
        }

        .make-wish-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 45px rgba(240, 147, 251, 0.5);
        }

        .make-wish-btn:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(240, 147, 251, 0.4), 0 18px 45px rgba(240, 147, 251, 0.5);
        }

        .make-wish-btn:active {
            transform: translateY(-1px);
        }

        .make-wish-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Sacred Geometry Loading */
        .sacred-geometry-container {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .flower-of-life {
            width: 50px;
            height: 50px;
            margin-right: 12px;
            vertical-align: middle;
        }

        .flower-of-life circle {
            fill: none;
            stroke: white;
            stroke-width: 1.5;
            opacity: 0.8;
        }

        .outer-ring {
            animation: rotate-cw 4s linear infinite;
            transform-origin: 100px 100px;
        }

        .center-circle {
            animation: rotate-ccw 3s linear infinite, pulse-geometry 2s ease-in-out infinite;
            transform-origin: 100px 100px;
        }

        @keyframes rotate-cw {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes rotate-ccw {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }

        @keyframes pulse-geometry {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1.0; }
        }

        /* Accessibility: Reduce motion */
        @media (prefers-reduced-motion: reduce) {
            .outer-ring, .center-circle {
                animation: none !important;
            }
        }

        .loading-text {
            font-size: 15px;
            color: white;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        /* Consciousness Influence Meter */
        .consciousness-influence-meter {
            position: relative;
            background: rgba(168, 85, 247, 0.08);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .meter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .meter-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .meter-value {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .meter-visual {
            margin: 16px 0;
        }

        .meter-track {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #6b7280 0%, #a855f7 50%, #ec4899 100%);
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.6);
            border-radius: 4px;
        }

        .meter-stats {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 16px 0;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: white;
        }

        .stat-arrow {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .quantum-coherence {
            text-align: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .coherence-label {
            margin-right: 8px;
        }

        .coherence-value {
            font-weight: 600;
            color: #a855f7;
        }

        /* Probability Distribution Graph */
        .probability-graph-container {
            margin: 35px 0;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .graph-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .probability-graph {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .graph-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        .legend-marker {
            display: inline-block;
            flex-shrink: 0;
        }

        .legend-text {
            white-space: nowrap;
            font-weight: 500;
        }

        .center-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
        }

        @keyframes growBar {
            from { height: 0; y: 70; }
            to { height: var(--bar-height); y: var(--bar-y); }
        }

        @keyframes pulseHighlight {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.9; }
        }

        /* Sacred Geometry Loading Backdrop - QUANTUM COLLAPSE ANIMATION */
        .sacred-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(102, 126, 234, 0.98) 0%, rgba(118, 75, 162, 0.98) 100%);
            backdrop-filter: blur(10px);
            z-index: 10000;
            overflow: hidden;
        }

        .sacred-backdrop.show {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 30px;
            animation: backdropReveal 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes backdropReveal {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* QUANTUM PARTICLE FIELD - Creates depth and movement */
        .quantum-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .quantum-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: particleFloat 3.5s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: translate(0, 0) scale(0);
            }
            20% {
                opacity: 0.8;
            }
            50% {
                opacity: 1;
            }
            80% {
                opacity: 0.6;
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        /* PRIMARY SACRED GEOMETRY - Quantum collapse animation */
        .sacred-geometry-large {
            width: 0px;
            height: 0px;
            position: relative;
            filter: drop-shadow(0 0 60px rgba(255, 255, 255, 0.7));
            animation: quantumCollapse 3.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* MULTI-LAYERED GEOMETRY FOR DEPTH */
        .geometry-layer-1 {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: layer1Animation 3.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .geometry-layer-2 {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: layer2Animation 3.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        .geometry-layer-3 {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: layer3Animation 3.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* MAIN QUANTUM COLLAPSE - Point to screen to point */
        @keyframes quantumCollapse {
            0% {
                width: 0px;
                height: 0px;
                opacity: 0;
                transform: rotate(0deg) scale(0);
                filter: drop-shadow(0 0 0px rgba(255, 255, 255, 0));
            }
            5% {
                opacity: 1;
            }
            35% {
                width: min(800px, 150vw);
                height: min(800px, 150vh);
                transform: rotate(540deg) scale(1.2);
                filter: drop-shadow(0 0 100px rgba(240, 147, 251, 1));
            }
            65% {
                width: min(800px, 150vw);
                height: min(800px, 150vh);
                transform: rotate(900deg) scale(1.15);
                opacity: 1;
            }
            95% {
                width: 0px;
                height: 0px;
                transform: rotate(1440deg) scale(0);
                opacity: 0.3;
                filter: drop-shadow(0 0 120px rgba(245, 87, 108, 1));
            }
            100% {
                width: 0px;
                height: 0px;
                transform: rotate(1440deg) scale(0);
                opacity: 0;
                filter: drop-shadow(0 0 0px rgba(255, 255, 255, 0));
            }
        }

        /* LAYER ANIMATIONS - Different expansion rates for depth */
        @keyframes layer1Animation {
            0%, 100% {
                transform: rotate(0deg) scale(1);
                opacity: 0;
            }
            35% {
                transform: rotate(-720deg) scale(1.3);
                opacity: 0.95;
            }
            65% {
                transform: rotate(-1080deg) scale(1.25);
                opacity: 0.9;
            }
        }

        @keyframes layer2Animation {
            0%, 100% {
                transform: rotate(0deg) scale(1);
                opacity: 0;
            }
            35% {
                transform: rotate(360deg) scale(0.85);
                opacity: 0.7;
            }
            65% {
                transform: rotate(540deg) scale(0.8);
                opacity: 0.65;
            }
        }

        @keyframes layer3Animation {
            0%, 100% {
                transform: rotate(0deg) scale(1);
                opacity: 0;
            }
            35% {
                transform: rotate(900deg) scale(1.5);
                opacity: 0.4;
            }
            65% {
                transform: rotate(1260deg) scale(1.45);
                opacity: 0.35;
            }
        }

        /* CIRCLE STROKE ANIMATIONS - Sacred geometry breathing */
        .sacred-geometry-large circle {
            fill: none;
            stroke: white;
            stroke-width: 2;
            opacity: 0;
            animation: circleReveal 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes circleReveal {
            0% {
                opacity: 0;
                stroke-width: 0;
                stroke: rgba(255, 255, 255, 0);
            }
            20% {
                opacity: 0.9;
                stroke-width: 2.5;
                stroke: rgba(255, 255, 255, 1);
            }
            40% {
                stroke: rgba(240, 147, 251, 1);
            }
            60% {
                stroke: rgba(245, 87, 108, 1);
            }
            80% {
                opacity: 0.7;
                stroke-width: 1.5;
                stroke: rgba(255, 255, 255, 0.8);
            }
            100% {
                opacity: 0;
                stroke-width: 0;
                stroke: rgba(255, 255, 255, 0);
            }
        }

        /* LAYER-SPECIFIC CIRCLE COLORS */
        .geometry-layer-1 circle {
            animation: circleLayer1 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .geometry-layer-2 circle {
            animation: circleLayer2 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .geometry-layer-3 circle {
            animation: circleLayer3 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes circleLayer1 {
            0%, 100% { opacity: 0; stroke: rgba(255, 255, 255, 0); }
            35% { opacity: 1; stroke: rgba(240, 147, 251, 1); }
            65% { opacity: 0.9; stroke: rgba(245, 87, 108, 0.9); }
        }

        @keyframes circleLayer2 {
            0%, 100% { opacity: 0; stroke: rgba(255, 255, 255, 0); }
            35% { opacity: 0.7; stroke: rgba(255, 255, 255, 0.7); }
            65% { opacity: 0.6; stroke: rgba(240, 147, 251, 0.6); }
        }

        @keyframes circleLayer3 {
            0%, 100% { opacity: 0; stroke: rgba(255, 255, 255, 0); }
            35% { opacity: 0.4; stroke: rgba(245, 87, 108, 0.5); }
            65% { opacity: 0.3; stroke: rgba(255, 255, 255, 0.3); }
        }

        /* LIGHT RAYS FROM CENTER */
        .light-ray {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 3px;
            height: 0%;
            background: linear-gradient(to bottom,
                rgba(255, 255, 255, 0) 0%,
                rgba(240, 147, 251, 0.8) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            transform-origin: top center;
            opacity: 0;
            animation: rayExpand 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes rayExpand {
            0% {
                height: 0%;
                opacity: 0;
            }
            35% {
                height: 100vh;
                opacity: 0.9;
            }
            65% {
                height: 100vh;
                opacity: 0.7;
            }
            100% {
                height: 0%;
                opacity: 0;
            }
        }

        /* GLOW PULSE FROM CENTER */
        .center-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0px;
            height: 0px;
            background: radial-gradient(circle,
                rgba(240, 147, 251, 0.9) 0%,
                rgba(245, 87, 108, 0.6) 30%,
                rgba(255, 255, 255, 0) 70%
            );
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: glowExpand 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes glowExpand {
            0% {
                width: 0px;
                height: 0px;
                opacity: 0;
            }
            35% {
                width: 120vmax;
                height: 120vmax;
                opacity: 0.6;
            }
            65% {
                width: 120vmax;
                height: 120vmax;
                opacity: 0.4;
            }
            100% {
                width: 0px;
                height: 0px;
                opacity: 0;
            }
        }

        /* SACRED GEOMETRY LOADING TEXT */
        .sacred-backdrop-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 600;
            color: white;
            text-align: center;
            letter-spacing: 1px;
            z-index: 100;
            animation: textPulseCollapse 3.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            text-shadow: 0 0 30px rgba(240, 147, 251, 0.8);
        }

        @keyframes textPulseCollapse {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            20% {
                opacity: 1;
                transform: scale(1);
                text-shadow: 0 0 30px rgba(240, 147, 251, 0.8);
            }
            50% {
                text-shadow: 0 0 60px rgba(245, 87, 108, 1);
            }
            80% {
                opacity: 0.9;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.8);
            }
        }

        /* Results */
        .results-container {
            display: none;
        }

        .results-container.show {
            display: block;
        }

        .outcome-message {
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            margin: 30px 0;
            padding: 30px;
            background: rgba(240, 147, 251, 0.15);
            border-radius: 16px;
            border-left: 4px solid var(--accent);
        }

        .probability-display {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            gap: 20px;
        }

        .prob-item {
            flex: 1;
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .prob-item:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .prob-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .prob-value {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
        }

        .wish-again-btn {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Space Grotesk', sans-serif;
            margin-top: 20px;
        }

        .wish-again-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .wish-again-btn.disabled {
            opacity: 0.4;
            cursor: pointer;
            background: rgba(128, 128, 128, 0.2);
            border-color: rgba(128, 128, 128, 0.4);
        }

        .wish-again-btn.disabled:hover {
            background: rgba(128, 128, 128, 0.3);
            border-color: rgba(128, 128, 128, 0.5);
        }

        /* Recent Wishes Feed */
        .recent-wishes-section {
            margin-top: 60px;
            margin-bottom: 60px;
        }

        .recent-wishes-section h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 32px;
            text-align: center;
            margin-bottom: 15px;
        }

        .recent-wishes-subtitle {
            text-align: center;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 40px;
            font-style: italic;
        }

        .wish-feed {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .wish-feed-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            animation: slideInFeed 0.5s ease-out;
        }

        @keyframes slideInFeed {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .wish-feed-item:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateX(5px);
        }

        .wish-feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .wish-feed-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .wish-feed-percent {
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .wish-feed-text {
            font-size: 14px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.85);
            font-style: italic;
        }

        .wish-feed-loading {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }

        /* Pricing Section */
        .pricing-section {
            margin-top: 100px;
            padding-top: 80px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pricing-section h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }

        .pricing-subtitle {
            text-align: center;
            font-size: 18px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 60px;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .pricing-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 48px 36px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .pricing-card:hover {
            transform: translateY(-12px);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 24px 70px rgba(0, 0, 0, 0.3);
        }

        .pricing-card.featured {
            border-color: var(--accent);
            box-shadow: 0 24px 70px rgba(240, 147, 251, 0.35);
            transform: scale(1.03);
        }

        .pricing-card.featured:hover {
            transform: scale(1.03) translateY(-12px);
            box-shadow: 0 28px 80px rgba(240, 147, 251, 0.45);
        }

        .pricing-card.special {
            border-color: rgba(240, 147, 251, 0.4);
            box-shadow: 0 15px 40px rgba(240, 147, 251, 0.2);
            transform: scale(1.02);
        }

        .badge {
            position: absolute;
            top: -15px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tier-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .price {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, white 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .price-period {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }

        .features {
            list-style: none;
            margin-bottom: 30px;
            flex-grow: 1;
        }

        .features li {
            padding: 12px 0;
            padding-left: 30px;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        .features li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: 700;
            font-size: 16px;
        }

        .cta-button {
            width: 100%;
            padding: 18px;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: block;
            text-align: center;
            font-family: 'Space Grotesk', sans-serif;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }

        .cta-button:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3), 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .cta-button.secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.8);
            color: white;
        }

        .cta-button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: white;
        }

        .cta-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Info Section */
        .info-section {
            font-size: 16px;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
            padding: 52px 48px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 28px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-top: 80px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .info-section:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .info-section h3 {
            color: white;
            margin-bottom: 24px;
            font-size: 28px;
            font-weight: 600;
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.5px;
        }

        .info-section p {
            margin-bottom: 20px;
        }

        .info-section p:last-child {
            margin-bottom: 0;
        }

        /* Email Signup Bar */
        /* Testimonials Section */
        .testimonials-section {
            margin-top: 80px;
            padding: 60px 0;
        }

        .testimonials-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 32px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 48px;
            color: white;
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .testimonial-card {
            padding: 32px 28px;
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .testimonial-card:hover {
            background: rgba(255, 255, 255, 0.09);
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(139, 92, 246, 0.15);
        }

        .testimonial-stars {
            color: #fbbf24;
            font-size: 18px;
            margin-bottom: 16px;
            letter-spacing: 2px;
        }

        .testimonial-text {
            font-size: 15px;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            font-style: italic;
        }

        .testimonial-author {
            font-size: 14px;
            color: rgba(139, 92, 246, 0.9);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .testimonials-section {
                margin-top: 60px;
                padding: 40px 0;
            }

            .testimonials-title {
                font-size: 28px;
                margin-bottom: 32px;
            }

            .testimonials-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .testimonial-card {
                padding: 28px 24px;
            }
        }

        /* Result Explanation Panel (4-Tier System) */
        .explanation-panel {
            margin-top: 24px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            animation: slideInExplanation 0.5s ease-out;
        }

        @keyframes slideInExplanation {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .explanation-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .explanation-icon {
            font-size: 28px;
            line-height: 1;
        }

        .explanation-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
            color: white;
        }

        .explanation-description {
            font-size: 15px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
            margin: 12px 0 16px 0;
        }

        .explanation-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .metric {
            text-align: center;
        }

        .metric-label {
            display: block;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .explanation-action {
            padding: 16px;
            background: rgba(139, 92, 246, 0.15);
            border-radius: 10px;
            font-size: 15px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }

        .explanation-action strong {
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .explanation-panel {
                padding: 20px;
                margin-top: 20px;
            }

            .explanation-title {
                font-size: 18px;
            }

            .explanation-metrics {
                gap: 12px;
                padding: 16px;
            }

            .metric-value {
                font-size: 20px;
            }

            .explanation-action {
                padding: 14px;
                font-size: 14px;
            }
        }

        .email-signup-bar {
            margin-top: 80px;
            padding: 40px 48px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .email-signup-bar:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .email-signup-bar h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 12px;
            color: white;
        }

        .email-signup-bar p {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .email-signup-form {
            display: flex;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }

        .email-signup-input {
            flex: 1;
            padding: 18px 24px;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .email-signup-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        }

        .email-signup-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .email-signup-button {
            padding: 18px 36px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Space Grotesk', sans-serif;
            white-space: nowrap;
        }

        .email-signup-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4);
        }

        .email-signup-message {
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        /* Special Wish Card */
        .special-wish-container {
            margin-top: 50px;
            margin-bottom: 60px;
        }

        .special-wish-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 48px;
            border: 2px solid rgba(240, 147, 251, 0.3);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 600px;
            margin: 0 auto;
        }

        .special-wish-card:hover {
            transform: translateY(-8px);
            border-color: rgba(240, 147, 251, 0.5);
            box-shadow: 0 24px 60px rgba(240, 147, 251, 0.3);
        }

        .special-wish-emoji {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .special-wish-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 15px;
            color: white;
        }

        .special-wish-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .special-wish-price {
            font-size: 48px;
            font-weight: 700;
            margin: 20px 0;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .special-wish-cta {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Space Grotesk', sans-serif;
            text-decoration: none;
            display: inline-block;
            margin: 0 auto;
        }

        .special-wish-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 9999;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 32px;
            padding: 50px 40px;
            max-width: 500px;
            width: 100%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: slideUp 0.4s ease-out;
            text-align: center;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-emoji {
            font-size: 72px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .modal-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-subtitle {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .modal-price {
            font-size: 56px;
            font-weight: 700;
            margin: 20px 0;
            color: white;
        }

        .modal-price-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }

        .modal-cta-primary {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            background: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-cta-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-cta-secondary {
            width: 100%;
            padding: 18px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            text-decoration: none;
            display: block;
        }

        .modal-cta-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 80px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 42px;
                letter-spacing: -1px;
                margin-bottom: 20px;
            }
            .logo { font-size: 64px; }
            .tagline {
                font-size: 18px;
                line-height: 1.6;
            }
            .card {
                padding: 36px 24px;
                border-radius: 24px;
            }
            .pricing-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            .pricing-card {
                padding: 40px 28px;
            }
            .pricing-card.featured {
                transform: scale(1);
            }
            .pricing-card.featured:hover {
                transform: translateY(-8px);
            }
            .nav-links { gap: 15px; font-size: 13px; }

            .wish-input {
                padding: 20px;
                min-height: 120px;
                font-size: 16px;
            }

            .make-wish-btn {
                padding: 22px;
                font-size: 18px;
            }

            .cta-button {
                padding: 16px;
                min-height: 56px;
            }

            .modal-overlay {
                align-items: flex-end;  /* Bottom sheet style on mobile */
            }

            .modal {
                padding: 40px 25px;
                margin: 0;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
                max-height: 90vh;
                overflow-y: auto;
                width: 100%;
                max-width: 100%;
            }

            .modal-title {
                font-size: 28px;
            }

            .modal-subtitle {
                font-size: 16px;
            }

            .modal-price {
                font-size: 48px;
            }

            .modal-cta-primary,
            .modal-cta-secondary {
                font-size: 16px;
                padding: 18px;
                min-height: 56px;  /* Touch-friendly tap target */
            }

            .email-signup-bar {
                padding: 32px 24px;
                margin-top: 60px;
            }

            .email-signup-form {
                flex-direction: column;
                gap: 12px;
            }

            .email-signup-button {
                width: 100%;
                padding: 18px;
            }

            .special-wish-card {
                padding: 36px 24px;
            }

            .special-wish-emoji {
                font-size: 48px;
            }

            .special-wish-title {
                font-size: 26px;
            }

            .special-wish-price {
                font-size: 40px;
            }
        }

        /* ============================================
           MOBILE-FIRST RESPONSIVE DESIGN
           Target: 60%+ mobile traffic
           ============================================ */
        @media (max-width: 768px) {
            /* Hero section mobile optimization */
            .logo {
                font-size: 56px;
                margin-bottom: 20px;
            }

            .hero-brand {
                font-size: 40px;
                margin-bottom: 24px;
                letter-spacing: -0.02em;
            }

            .hero-value-prop {
                font-size: 20px;
                margin-bottom: 32px;
                padding: 0 16px;
            }

            .hero-cta-text {
                font-size: 18px;
                margin-bottom: 40px;
            }

            /* Legacy mobile styles */
            h1 {
                font-size: 42px;
                letter-spacing: -1px;
            }

            .tagline {
                font-size: 18px;
            }

            .hero-description {
                font-size: 15px;
                text-align: center;
            }

            /* Consciousness meter mobile */
            .consciousness-influence-meter {
                padding: 16px;
                margin: 20px -10px;
            }

            .meter-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .meter-value {
                font-size: 20px;
            }

            .meter-stats {
                gap: 12px;
            }

            .stat-value {
                font-size: 16px;
            }

            /* Probability graph mobile */
            .probability-graph-container {
                padding: 16px;
                margin: 20px -10px;
            }

            .probability-graph {
                max-height: 200px;
            }

            /* Card mobile */
            .card {
                padding: 32px 24px;
                margin-bottom: 24px;
            }

            .wish-input {
                padding: 18px;
                font-size: 16px;
                min-height: 120px;
            }

            .make-wish-btn {
                padding: 20px;
                font-size: 18px;
            }

            /* Probability display mobile */
            .probability-display {
                flex-direction: column;
                gap: 12px;
            }

            .prob-item {
                padding: 20px;
            }

            /* Stats grid mobile */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            /* Sacred geometry - faster animation on mobile + constrained size */
            .sacred-geometry-large {
                animation-duration: 2.5s;
            }

            /* Mobile-specific sacred geometry sizing */
            @keyframes quantumCollapse {
                0% {
                    width: 0px;
                    height: 0px;
                    opacity: 0;
                    transform: rotate(0deg) scale(0);
                    filter: drop-shadow(0 0 0px rgba(255, 255, 255, 0));
                }
                5% {
                    opacity: 1;
                }
                35% {
                    width: min(300px, 100vw);
                    height: min(300px, 100vw);
                    transform: rotate(540deg) scale(0.9);
                    filter: drop-shadow(0 0 60px rgba(240, 147, 251, 1));
                }
                65% {
                    width: min(300px, 100vw);
                    height: min(300px, 100vw);
                    transform: rotate(900deg) scale(0.85);
                    opacity: 1;
                }
                95% {
                    width: 0px;
                    height: 0px;
                    transform: rotate(1440deg) scale(0);
                    opacity: 0.3;
                    filter: drop-shadow(0 0 80px rgba(245, 87, 108, 1));
                }
                100% {
                    width: 0px;
                    height: 0px;
                    opacity: 0;
                    transform: rotate(1440deg) scale(0);
                    filter: drop-shadow(0 0 0px rgba(255, 255, 255, 0));
                }
            }

            /* Navigation mobile */
            .nav-links {
                gap: 15px;
                font-size: 13px;
            }

            .nav-link.btn {
                padding: 6px 14px;
            }

            /* Container mobile */
            .container {
                padding: 80px 16px 32px;
            }
        }

        /* Tablet breakpoint */
        @media (min-width: 769px) and (max-width: 1024px) {
            h1 {
                font-size: 54px;
            }
        }

        /* ============================================
           ACCESSIBILITY ENHANCEMENTS
           Target: WCAG AA Compliant
           ============================================ */

        /* Enhanced reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }

            /* Hide purely decorative animations */
            .hero-particles,
            .quantum-particle,
            .particle,
            .quantum-field,
            .superposition-wave {
                display: none !important;
            }

            /* Disable complex animations */
            .sacred-geometry-large,
            .sacred-backdrop,
            .light-ray,
            .center-glow,
            .geometry-layer-1,
            .geometry-layer-2,
            .geometry-layer-3 {
                animation: none !important;
            }

            /* Keep essential transitions for UX */
            .make-wish-btn:hover,
            .card:hover {
                transform: none;
            }

            .arrow-down {
                animation: none;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            body {
                background: #000;
            }

            .card {
                background: rgba(255, 255, 255, 0.15);
                border: 2px solid rgba(255, 255, 255, 0.4);
            }

            .wish-input {
                border-width: 3px;
                background: rgba(255, 255, 255, 0.12);
            }

            .make-wish-btn {
                border: 2px solid white;
            }
        }

        /* ============================================
           STICKY MOBILE CTA
           ============================================ */

        .sticky-mobile-cta {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 999;
            padding: 12px 20px 20px;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.98) 70%, transparent);
            backdrop-filter: blur(10px);
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .sticky-cta-btn {
            width: 100%;
            padding: 18px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            font-family: 'Space Grotesk', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4);
            min-height: 56px; /* Ensures 44px+ touch target */
        }

        .sticky-cta-btn:active {
            transform: scale(0.98);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* Only show on mobile */
        @media (min-width: 769px) {
            .sticky-mobile-cta {
                display: none !important;
            }
        }

        /* ============================================
           PERFORMANCE OPTIMIZATIONS
           ============================================ */

        /* CSS Containment for better rendering performance */
        .probability-graph-container {
            contain: layout style paint;
        }

        .card {
            contain: layout style;
        }

        .consciousness-influence-meter {
            contain: layout style paint;
        }

        .hero {
            contain: layout paint;
        }

        /* GPU acceleration for smooth animations */
        .make-wish-btn,
        .card,
        .sacred-geometry-large,
        .quantum-particle {
            will-change: transform;
        }

        /* Optimize for 60 FPS */
        @media (hover: hover) {
            .card:hover {
                backface-visibility: hidden;
                perspective: 1000px;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
                color: black;
            }

            .nav,
            .particles,
            .hero-particles,
            .make-wish-btn,
            .sacred-backdrop {
                display: none !important;
            }

            .card {
                background: none;
                border: 1px solid #000;
                page-break-inside: avoid;
            }
        }
    </style>

    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init hi $r kr ui wr Er capture Ri calculateEventProperties Ir register register_once register_for_session unregister unregister_for_session Fr getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Cr Tr createPersonProfile Or yr Mr opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing Pr debug L Rr getPageViewId captureTraceFeedback captureTraceMetric gr".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);

        posthog.init('phc_3LVAMPpwJoDgTWRSZFhucMBN2SqVcAMOJTFBKzgsuBu', {
            api_host: 'https://us.i.posthog.com',
            defaults: '2025-05-24',
            person_profiles: 'identified_only',
            autocapture: false,
            capture_pageview: true,
            capture_pageleave: true
        });
    </script>
</head>
<body>
    <div class="particles" id="particles"></div>

    <nav class="nav" id="nav">
        <div class="nav-container">
            <a href="/" class="nav-brand">✨ The Wish Machine</a>
            <div class="nav-links">
                {% if user and user.is_authenticated %}
                    <span class="user-info">{{ user.email }}</span>
                    <a href="/#pricing" class="nav-link">Pricing</a>
                    <a href="/auth/account" class="nav-link">Account</a>
                    <a href="/auth/logout" class="nav-link">Logout</a>
                {% else %}
                    <a href="/#pricing" class="nav-link">Pricing</a>
                    <a href="/auth/login" class="nav-link">Login</a>
                    <a href="/auth/signup" class="nav-link btn">Sign Up</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Sticky Mobile CTA (only shows on mobile after scrolling) -->
    <div class="sticky-mobile-cta" id="stickyCTA" style="display: none;">
        <button class="sticky-cta-btn" onclick="scrollToWishInput()">
            Make Your Wish ✨
        </button>
    </div>

    <div class="container">
        <div class="hero">
            <!-- Quantum particle background -->
            <div class="hero-particles" id="hero-particles"></div>

            <div class="hero-content">
                <div class="logo">✨</div>
                <h1 class="hero-brand">The Wish Machine</h1>
                <p class="hero-value-prop">What makes wishes come true?</p>
                <p class="hero-cta-text"><strong>It starts with intention.</strong></p>

                <!-- Live social proof -->
                <!--
                <div class="social-proof-bar">
                    <span class="wish-counter">
                        <span id="wish-count">14,847</span> wishes made this week
                    </span>
                    <span class="live-indicator">
                        <span class="pulse-dot"></span>
                        Live
                    </span>
                </div>
                -->

                <!-- Call to action hint -->
                <div class="hero-cta-hint">
                    <svg class="arrow-down" width="24" height="24" viewBox="0 0 24 24" style="overflow: visible;">
                        <path d="M12 4v16m0 0l-6-6m6 6l6-6" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Make your first wish</span>
                </div>
            </div>
        </div>

        <div class="card">
            <label for="wish-text">Your Wish</label>
            <textarea
                id="wish-text"
                class="wish-input"
                placeholder="Type your wish here... The universe is listening."
                maxlength="500"
            ></textarea>

            <div class="intensity-slider">
                <label>Intention Intensity</label>
                <input type="range" id="intensity" min="1" max="100" value="1">
                <div class="intensity-value" id="intensity-value">1%</div>
            </div>

            <button class="make-wish-btn" id="make-wish-btn">
                Make Your Wish
            </button>
        </div>

        <div class="results-container" id="results-container">
            <div class="card">
                <div class="outcome-message" id="outcome-message"></div>
                <div class="probability-display">
                    <div class="prob-item">
                        <div class="prob-label">Manifested</div>
                        <div class="prob-value" id="success-prob">0%</div>
                    </div>
                    <div class="prob-item">
                        <div class="prob-label">Not Yet</div>
                        <div class="prob-value" id="failure-prob">0%</div>
                    </div>
                </div>
                <div class="stats-grid" id="stats-grid"></div>

                <!-- Consciousness Influence Meter -->
                <div class="consciousness-influence-meter" id="consciousness-meter" style="display: none;">
                    <div class="meter-header">
                        <span class="meter-title">Consciousness Influence</span>
                        <span class="meter-value" id="influence-value">+0%</span>
                    </div>

                    <div class="meter-visual">
                        <div class="meter-track">
                            <div class="meter-fill" id="meter-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="meter-stats">
                        <div class="stat">
                            <span class="stat-label">Baseline</span>
                            <span class="stat-value" id="baseline-value">50.0%</span>
                        </div>
                        <div class="stat-arrow">→</div>
                        <div class="stat">
                            <span class="stat-label">Your Result</span>
                            <span class="stat-value" id="actual-value">---%</span>
                        </div>
                    </div>

                    <div class="quantum-coherence">
                        <span class="coherence-label">Quantum Coherence:</span>
                        <span class="coherence-value" id="coherence-value">---</span>
                    </div>
                </div>

                <!-- Probability Distribution Graph -->
                <div class="probability-graph-container">
                    <h4 class="graph-title">Distribution of Possible Outcomes</h4>

                    <svg class="probability-graph" viewBox="0 0 240 140" id="prob-graph" preserveAspectRatio="xMidYMid meet">
                        <!-- Gradient definitions -->
                        <defs>
                            <linearGradient id="barGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#f093fb;stop-opacity:0.9" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.9" />
                            </linearGradient>
                            <linearGradient id="baselineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.15" />
                            </linearGradient>
                        </defs>
                        <!-- Visualization rendered by JavaScript -->
                    </svg>
                    <!-- Simplified Legend (Updated for new visualization) -->
                    <div class="graph-legend">
                        <div class="legend-item">
                            <span class="legend-marker" style="border-left: 2px dashed rgba(156, 163, 175, 0.6); height: 12px;"></span>
                            <span class="legend-text">Baseline (50%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="border-left: 3px solid #10b981; height: 12px;"></span>
                            <span class="legend-text">Your result</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: linear-gradient(90deg, #10b981, transparent); width: 16px; height: 3px; display: inline-block; position: relative;">
                                <span style="position: absolute; right: -3px; top: -2px; width: 0; height: 0; border-left: 5px solid #10b981; border-top: 3px solid transparent; border-bottom: 3px solid transparent;"></span>
                            </span>
                            <span class="legend-text">Shift arrow</span>
                        </div>
                    </div>
                </div>

                <!-- Result Explanation Panel (4-Tier System) -->
                <div class="explanation-panel" id="explanation-panel" style="display: none;">
                    <div class="explanation-header">
                        <span class="explanation-icon" id="explanation-icon"></span>
                        <h4 class="explanation-title" id="explanation-title"></h4>
                    </div>
                    <p class="explanation-description" id="explanation-description"></p>
                    <div class="explanation-metrics">
                        <div class="metric">
                            <span class="metric-label">Baseline</span>
                            <span class="metric-value">50%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Your Result</span>
                            <span class="metric-value" id="result-value"></span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Shift</span>
                            <span class="metric-value" id="shift-value"></span>
                        </div>
                    </div>
                    <div class="explanation-action" id="explanation-action"></div>
                </div>

                <button class="wish-again-btn" onclick="resetWish()">Make Another Wish</button>
            </div>
        </div>

        <!-- Recent Wishes Feed -->
        <div class="recent-wishes-section">
            <h2>Last 5 Wishes</h2>
            <p class="recent-wishes-subtitle">A curated glimpse into collective intention</p>
            <div class="wish-feed" id="wish-feed">
                <div class="wish-feed-loading">Loading recent wishes...</div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="info-section">
            <h3>How It Works</h3>
            <p>
                Yes, this sounds ridiculous. Olympic athletes have been visualizing their performance for decades. The body doesn't know the difference between a vividly imagined experience and a real one. We're simply extending that logic to everything that matters. Whether you're building relationships, making art, or growing a business, the mechanism is the same: focused consciousness influences how your reality unfolds.
            </p>
            <p>
                Your baseline Consciousness is like your credit score for the universe: it starts wherever it starts, but it compounds with intention. We help you take actions that increase your Consciousness so wishes have better chances of coming true. Each wish runs 1000 quantum collapse simulations, measuring how your focused attention influences your reality. The more you practice, the stronger your signal gets. 
            </p>
            <p>
                In an era of infinite digital noise, we're curating something else: deliberate, meaningful intention. Most worthwhile things are absurd until they're not.
            </p>
        </div>

        <!-- Testimonials Section -->
        <!--
        <div class="testimonials-section">
            <h3 class="testimonials-title">What People Are Experiencing</h3>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-stars">★★★★★</div>
                    <p class="testimonial-text">"Hit 87% on my third wish. I've been practicing visualization for years, but seeing the actual distribution shift is wild. Makes the practice tangible."</p>
                    <div class="testimonial-author">Sarah K., Product Designer</div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-stars">★★★★★</div>
                    <p class="testimonial-text">"My average went from 52% to 73% over 10 wishes. The consciousness meter helps me track when I'm actually focused vs. just going through the motions."</p>
                    <div class="testimonial-author">Marcus T., Founder</div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-stars">★★★★★</div>
                    <p class="testimonial-text">"Started at baseline (50%) like everyone. Three weeks of daily practice and I'm consistently hitting 65-70%. The quantum coherence feedback loop is real."</p>
                    <div class="testimonial-author">Priya M., ML Engineer</div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-stars">★★★★★</div>
                    <p class="testimonial-text">"Skeptical at first, but the bimodal distributions don't lie. Something shifts when intention is genuine. Now part of my morning routine."</p>
                    <div class="testimonial-author">James L., Data Scientist</div>
                </div>
            </div>
        </div>
        -->

        <!-- Email Signup Bar -->
        <div class="email-signup-bar">
            <h3>Stay Connected</h3>
            <p>Get matched with wish mates, receive consciousness insights, and explore the practice with us.</p>
            <form class="email-signup-form" onsubmit="handleEmailSignup(event)">
                <input
                    type="email"
                    id="main-email-input"
                    class="email-signup-input"
                    placeholder="your@email.com"
                    required
                />
                <button type="submit" class="email-signup-button">Join the Practice</button>
            </form>
            <div id="main-email-message" class="email-signup-message"></div>
            <p style="margin-top: 20px; font-size: 14px; color: rgba(255,255,255,0.7);">
                Want unlimited wishes? <a href="/#pricing" style="color: var(--accent); text-decoration: underline; font-weight: 600;">Explore Premium</a>
            </p>
        </div>

        <!-- Pricing Section -->
        <div class="pricing-section" id="pricing">
            <h2>Choose Your Practice</h2>
            <p class="pricing-subtitle">Intentional focus over infinite noise</p>

            <div class="pricing-grid">
                <div class="pricing-card">
                    <div class="tier-name">Free</div>
                    <div class="price">$0</div>
                    <div class="price-period">forever</div>
                    <p style="font-size: 13px; line-height: 1.6; margin-bottom: 20px; color: rgba(255,255,255,0.85);">
                        For those interested in exploring. Spend time exploring what Consciousness means and how to build it: your own understanding of yourself and the cosmos. No commitments, just pure curiosity and delight.
                    </p>
                    <ul class="features">
                        <li>1 wish per month</li>
                        <li>Accountability Tactics</li>
                        <li>Basic analytics</li>
                    </ul>
                    {% if user and user.is_authenticated %}
                        {% if user.subscription_tier == 'free' %}
                            <button class="cta-button" disabled>Current Plan</button>
                        {% else %}
                            <a href="/auth/account" class="cta-button secondary">Manage Plan</a>
                        {% endif %}
                    {% else %}
                        <a href="/auth/signup" class="cta-button">Get Started Free</a>
                    {% endif %}
                </div>

                <div class="pricing-card featured">
                    <div class="badge">Most Popular</div>
                    <div class="tier-name">Premium</div>
                    <div class="tier-subtitle" style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 15px; font-style: italic;">"The Collective"</div>
                    <div class="price">$9.99</div>
                    <div class="price-period">per month</div>
                    <p style="font-size: 13px; line-height: 1.6; margin-bottom: 20px; color: rgba(255,255,255,0.85);">
                        In an age of infinite content, we're curating meaningful connections. Get matched with others pursuing similar intentions. Learn from those who've walked your path a community walking the journey from intent to reality. 
                    </p>
                    <ul class="features">
                        <li>10 wishes per month</li>
                        <li>Match with similar wish-makers</li>
                        <li>Consciousness improvement strategies</li>
                        <li>Advanced analytics & insights</li>
                    </ul>
                    {% if user and user.is_authenticated %}
                        {% if user.subscription_tier == 'premium' and user.subscription_status == 'active' %}
                            <button class="cta-button" disabled>Current Plan</button>
                        {% else %}
                            <a href="/subscribe/premium" class="cta-button">Upgrade to Premium</a>
                        {% endif %}
                    {% else %}
                        <a href="/subscribe/premium" class="cta-button">Start Premium</a>
                    {% endif %}
                </div>

                <div class="pricing-card">
                    <div class="tier-name">Unlimited</div>
                    <div class="tier-subtitle" style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 15px; font-style: italic;">"The Actualization Lab"</div>
                    <div class="price">$29.99</div>
                    <div class="price-period">per month</div>
                    <p style="font-size: 13px; line-height: 1.6; margin-bottom: 20px; color: rgba(255,255,255,0.85);">
                        For those committed to the practice. Facilitated introductions to people manifesting complementary intentions—seeking accountability partners. Build the support structures that turn your intention into reality. 
                    </p>
                    <ul class="features">
                        <li>Unlimited wishes</li>
                        <li>Curated introductions (opt-in, privacy-first)</li>
                        <li>Intention Groups</li>
                        <li>Advanced manifestation analytics</li>
                        <li>Pattern analysis across cohorts</li>
                        <li>Early access to new features</li>
                    </ul>
                    {% if user and user.is_authenticated %}
                        {% if user.subscription_tier == 'unlimited' and user.subscription_status == 'active' %}
                            <button class="cta-button" disabled>Current Plan</button>
                        {% else %}
                            <a href="/subscribe/unlimited" class="cta-button">Go Unlimited</a>
                        {% endif %}
                    {% else %}
                        <a href="/subscribe/unlimited" class="cta-button">Get Unlimited</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Special Wish Card -->
        <div class="special-wish-container">
            <div class="special-wish-card">
                <div class="special-wish-emoji">✨</div>
                <h3 class="special-wish-title">Just One More Wish</h3>
                <p class="special-wish-subtitle">
                    Not ready to commit to a monthly practice? Throw one more quarter in the wishing well. No subscription, no signup—just pure intention. <br> Examine that fractal edge of possibility one more time.
                </p>
                <div class="special-wish-price">$0.25</div>
                <a href="/buy-single-wish-guest" class="special-wish-cta">Make One More Wish</a>
            </div>
        </div>

        <footer>
            <p>Building Consciousness since &copy; 2025 The Wish Machine.  All rights reserved. <br> <br> Your intention is unique, but the patterns are universal. </p>
        </footer>
    </div>

    <!-- Sacred Geometry Loading Backdrop - QUANTUM COLLAPSE -->
    <div class="sacred-backdrop" id="sacredBackdrop">
        <!-- Quantum particle field background -->
        <div class="quantum-field" id="quantumField"></div>

        <!-- Center glow pulse -->
        <div class="center-glow"></div>

        <!-- Light rays emanating from center -->
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(0deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(45deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(90deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(135deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(180deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(225deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(270deg);"></div>
        <div class="light-ray" style="transform: translate(-50%, -50%) rotate(315deg);"></div>

        <!-- Multi-layered sacred geometry - Layer 3 (largest, slowest) -->
        <svg class="sacred-geometry-large" viewBox="0 0 200 200">
            <g class="geometry-layer-3">
                <circle cx="100" cy="100" r="50" />
                <circle cx="143.3" cy="125" r="50" />
                <circle cx="143.3" cy="75" r="50" />
                <circle cx="100" cy="50" r="50" />
                <circle cx="56.7" cy="75" r="50" />
                <circle cx="56.7" cy="125" r="50" />
                <circle cx="100" cy="150" r="50" />
            </g>

            <!-- Layer 2 (medium, counter-rotating) -->
            <g class="geometry-layer-2">
                <circle cx="100" cy="100" r="50" />
                <circle cx="143.3" cy="125" r="50" />
                <circle cx="143.3" cy="75" r="50" />
                <circle cx="100" cy="50" r="50" />
                <circle cx="56.7" cy="75" r="50" />
                <circle cx="56.7" cy="125" r="50" />
                <circle cx="100" cy="150" r="50" />
            </g>

            <!-- Layer 1 (primary, fastest) -->
            <g class="geometry-layer-1">
                <circle cx="100" cy="100" r="50" />
                <circle cx="143.3" cy="125" r="50" />
                <circle cx="143.3" cy="75" r="50" />
                <circle cx="100" cy="50" r="50" />
                <circle cx="56.7" cy="75" r="50" />
                <circle cx="56.7" cy="125" r="50" />
                <circle cx="100" cy="150" r="50" />
            </g>
        </svg>

        <div class="sacred-backdrop-text">Collapsing 1000 quantum states...</div>
    </div>

    <!-- Upsell Modal -->
    <div class="modal-overlay" id="upsellModal">
        <div class="modal">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-emoji">✨</div>
            <h3 class="modal-title" id="modalTitle">Continue the Practice?</h3>
            <p class="modal-subtitle" id="modalSubtitle">Each wish matters. No infinite scrolling, no ambient noise—just intentional focus. Try one more for a quarter, or join the practice with 10 curated wishes per month.</p>
            <p class="modal-stats" id="modalStats" style="font-size: 14px; color: rgba(139, 92, 246, 1); margin: 12px 0 0 0; font-weight: 600; display: none;"></p>
            <div class="modal-price">$0.25</div>
            <div class="modal-price-label">one wish, no subscription</div>
            <a href="/buy-single-wish-guest" class="modal-cta-primary" onclick="trackEvent('checkout_clicked', {plan: 'single_wish', price: 0.25})">One More Wish ($0.25)</a>
            <a href="/auth/signup" class="modal-cta-secondary" onclick="trackEvent('checkout_clicked', {plan: 'signup', price: 0})">Join for 10 Free Wishes/Month</a>

            <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.2);">
                <p style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 15px;">Stay connected: Get matched with wish mates, receive consciousness insights, explore wave-particle duality.</p>
                <input type="email" id="email-subscribe-input" placeholder="your@email.com" style="width: 100%; padding: 14px; font-size: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-family: 'Inter', sans-serif; margin-bottom: 12px;">
                <button onclick="subscribeEmail()" class="modal-cta-secondary" style="margin: 0; padding: 14px;">Keep Me in the Loop</button>
                <div id="email-subscribe-message" style="margin-top: 12px; font-size: 13px; display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Separate flags to track different modal triggers
        let modalShownAfterWish = false;
        let modalShownByScroll = false;

        // === LAZY LOADING OPTIMIZATION ===
        // Defer non-critical initializations to improve perceived performance
        let particlesInitialized = false;
        let heroParticlesInitialized = false;

        // Intersection Observer for lazy loading sections
        const lazyLoadObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Add 'loaded' class to trigger any deferred animations/content
                    entry.target.classList.add('loaded');
                    lazyLoadObserver.unobserve(entry.target);
                }
            });
        }, {
            rootMargin: '50px' // Start loading 50px before element enters viewport
        });

        // Observe results container and recent wishes for lazy loading
        document.addEventListener('DOMContentLoaded', () => {
            const resultsContainer = document.querySelector('.results-container');
            const recentWishesSection = document.querySelector('.recent-wishes-section');

            if (resultsContainer) lazyLoadObserver.observe(resultsContainer);
            if (recentWishesSection) lazyLoadObserver.observe(recentWishesSection);
        });

        // Create floating particles (adaptive count based on device)
        function createParticles() {
            if (particlesInitialized) return;
            particlesInitialized = true;

            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;

            // Adaptive particle count: desktop 50, tablet 35, mobile 15
            const particleCount = window.innerWidth > 1024 ? 50 : window.innerWidth > 768 ? 35 : 15;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Defer particle creation to idle time for better initial load
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => createParticles(), { timeout: 1000 });
        } else {
            setTimeout(createParticles, 100);
        }

        // Create quantum particle field in hero background (adaptive)
        function createHeroParticles() {
            if (heroParticlesInitialized) return;
            heroParticlesInitialized = true;

            const container = document.getElementById('hero-particles');
            if (!container) return;

            // Adaptive count: desktop 30, tablet 20, mobile 10
            const heroParticleCount = window.innerWidth > 1024 ? 30 : window.innerWidth > 768 ? 20 : 10;

            for (let i = 0; i < heroParticleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'quantum-particle';
                particle.style.cssText = `
                    position: absolute;
                    width: ${2 + Math.random() * 3}px;
                    height: ${2 + Math.random() * 3}px;
                    background: radial-gradient(circle, rgba(240, 147, 251, 0.8), transparent);
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    filter: blur(1px);
                    animation: float-particle ${15 + Math.random() * 10}s linear infinite;
                    animation-delay: ${Math.random() * 5}s;
                `;
                container.appendChild(particle);
            }
        }

        // Add float-particle animation CSS
        const heroParticleStyle = document.createElement('style');
        heroParticleStyle.textContent = `
            @keyframes float-particle {
                0% { transform: translate(0, 0) scale(1); opacity: 0; }
                10% { opacity: 0.6; }
                90% { opacity: 0.4; }
                100% { transform: translate(${-50 + Math.random() * 100}px, -100vh) scale(0.5); opacity: 0; }
            }
        `;
        document.head.appendChild(heroParticleStyle);

        // Initialize hero particles (deferred for better performance)
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => createHeroParticles(), { timeout: 500 });
        } else {
            setTimeout(createHeroParticles, 50);
        }

        // === POSTHOG TRACKING HELPER ===
        // Safely track events even if PostHog isn't initialized
        function trackEvent(eventName, properties = {}) {
            if (typeof posthog !== 'undefined' && posthog && posthog.capture) {
                try {
                    posthog.capture(eventName, properties);
                } catch (e) {
                    console.log('Analytics tracking skipped:', e.message);
                }
            }
        }

        // Update wish counter from API
        async function updateWishCounter() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();

                const counterElement = document.getElementById('wish-count');
                if (counterElement) {
                    // Animate count up
                    const targetCount = data.weekly_wishes;
                    const currentCount = parseInt(counterElement.textContent.replace(/,/g, '')) || 14847;

                    // Simple count-up animation
                    const duration = 1000; // 1 second
                    const steps = 20;
                    const increment = (targetCount - currentCount) / steps;
                    let step = 0;

                    const timer = setInterval(() => {
                        step++;
                        const newCount = Math.round(currentCount + (increment * step));
                        counterElement.textContent = newCount.toLocaleString();

                        if (step >= steps) {
                            clearInterval(timer);
                            counterElement.textContent = targetCount.toLocaleString();
                        }
                    }, duration / steps);
                }
            } catch (error) {
                // Silently fail - default value already set in HTML
                console.log('Could not fetch wish stats');
            }
        }

        // Update counter on load and every 30 seconds
        updateWishCounter();
        setInterval(updateWishCounter, 30000);

        // Create quantum particles emanating from center during collapse (adaptive)
        function createQuantumParticles() {
            const quantumField = document.getElementById('quantumField');
            if (!quantumField) return;

            // Clear any existing particles
            quantumField.innerHTML = '';

            // Adaptive count: desktop 200, tablet 120, mobile 60
            const quantumParticleCount = window.innerWidth > 1024 ? 200 : window.innerWidth > 768 ? 120 : 60;

            // Create particles emanating from center
            for (let i = 0; i < quantumParticleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'quantum-particle';

                // Random angle for particle trajectory
                const angle = (Math.PI * 2 * i) / quantumParticleCount + (Math.random() * 0.1);

                // Random distance (some particles go further)
                const distance = 100 + Math.random() * 400;

                // Calculate final position
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;

                // Set CSS custom properties for animation
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);

                // Start from center of screen
                particle.style.left = '50%';
                particle.style.top = '50%';

                // Stagger the animation slightly
                particle.style.animationDelay = `${i * 2}ms`;

                // Random size variation
                const size = 1 + Math.random() * 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                quantumField.appendChild(particle);
            }
        }

        // Check if user is authenticated (passed from Flask template)
        const isAuthenticated = {% if user and user.is_authenticated %}true{% else %}false{% endif %};

        // Nav scroll effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('nav');
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });

        // Intensity slider with exponential resistance
        const intensitySlider = document.getElementById('intensity');
        const intensityValue = document.getElementById('intensity-value');

        if (intensitySlider && intensityValue) {
            // Initialize state
            let currentValue = 1; // Start at 1%
            let lastSliderPosition = 1;

            // Initialize display
            intensityValue.textContent = currentValue + '%';
            intensitySlider.dataset.actualValue = currentValue;

            // Exponential resistance function
            // Returns resistance multiplier: higher value = MORE resistance
            function getResistanceMultiplier(value) {
                // Exponential curve: 1.0 at low values, up to 20x at high values
                // This makes it take ~20x more drag distance to go from 90→100 vs 1→10
                const normalized = value / 100;
                return 1 + Math.pow(normalized, 3) * 19; // Range: 1x to 20x resistance
            }

            // Handle slider movement with resistance
            intensitySlider.addEventListener('input', function(e) {
                const newSliderPosition = parseFloat(e.target.value);
                const delta = newSliderPosition - lastSliderPosition;

                if (delta !== 0) {
                    // Calculate resistance based on current value
                    const resistanceMultiplier = getResistanceMultiplier(currentValue);

                    // Apply resistance: divide delta by resistance multiplier
                    const adjustedDelta = delta / resistanceMultiplier;

                    // Update current value
                    currentValue = Math.max(1, Math.min(100, currentValue + adjustedDelta));

                    // Sync slider position to match current value
                    // This creates the "resistance" feel
                    intensitySlider.value = currentValue;
                    lastSliderPosition = currentValue;

                    // Update display
                    intensityValue.textContent = Math.round(currentValue) + '%';

                    // Store for form submission
                    intensitySlider.dataset.actualValue = currentValue;

                    // Visual feedback based on resistance
                    if (resistanceMultiplier > 10) {
                        intensitySlider.style.cursor = 'grabbing'; // Very hard to move
                    } else if (resistanceMultiplier > 3) {
                        intensitySlider.style.cursor = 'grab'; // Moderate resistance
                    } else {
                        intensitySlider.style.cursor = 'ew-resize'; // Easy to move
                    }
                }
            });

            // Reset cursor after dragging
            intensitySlider.addEventListener('mouseup', function() {
                intensitySlider.style.cursor = 'ew-resize';
            });

            intensitySlider.addEventListener('touchend', function() {
                intensitySlider.style.cursor = 'ew-resize';
            });

        } else {
            console.error('Intensity slider elements not found!', {
                slider: !!intensitySlider,
                value: !!intensityValue
            });
        }

        // Make wish functionality
        const makeWishBtn = document.getElementById('make-wish-btn');
        const wishText = document.getElementById('wish-text');
        const resultsContainer = document.getElementById('results-container');

        // Check if user has reached their free wish limit (1 wish for anonymous users ONLY)
        function hasReachedWishLimit() {
            // Authenticated users should NEVER hit this client-side limit
            // Server will handle their subscription limits
            if (isAuthenticated) {
                return false;
            }

            // Only check localStorage for anonymous users
            const count = parseInt(localStorage.getItem('wishes_completed') || '0');
            return count >= 1; // 1 free wish for better conversion
        }

        function incrementWishCount() {
            const count = parseInt(localStorage.getItem('wishes_completed') || '0');
            localStorage.setItem('wishes_completed', (count + 1).toString());
            console.log(`Wish count: ${count + 1}/1`);
        }

        function getWishCount() {
            return parseInt(localStorage.getItem('wishes_completed') || '0');
        }

        // Store wish results for calculating averages
        function storeWishResult(manifestationPercentage) {
            try {
                const results = JSON.parse(localStorage.getItem('wish_results') || '[]');
                results.push({
                    percentage: manifestationPercentage,
                    timestamp: Date.now()
                });
                // Keep only last 10 wishes to avoid bloat
                if (results.length > 10) results.shift();
                localStorage.setItem('wish_results', JSON.stringify(results));
            } catch (e) {
                console.error('Error storing wish result:', e);
            }
        }

        function getWishResults() {
            try {
                return JSON.parse(localStorage.getItem('wish_results') || '[]');
            } catch (e) {
                return [];
            }
        }

        function calculateAverageShift() {
            const results = getWishResults();
            if (results.length === 0) return null;

            const sum = results.reduce((acc, r) => acc + r.percentage, 0);
            const average = sum / results.length;
            // Baseline is 50%, so shift is difference from baseline
            return average - 50;
        }

        function getLastWishResult() {
            const results = getWishResults();
            return results.length > 0 ? results[results.length - 1].percentage : null;
        }

        makeWishBtn.addEventListener('click', async () => {
            const wish = wishText.value.trim();
            // Use actualValue from dataset (exponential resistance), fallback to slider value
            const intensity = parseInt(intensitySlider.dataset.actualValue || intensitySlider.value || 1);

            if (!wish) {
                alert('Please enter a wish first!');
                return;
            }

            // Check if user has reached their free wish limit (3 wishes)
            if (hasReachedWishLimit()) {
                showModal();
                return;
            }

            // Track wish start
            trackEvent('wish_started', {
                wish_count: getWishCount() + 1,
                intensity: intensity,
                wish_length: wish.length
            });

            // Disable button and show sacred geometry loading
            makeWishBtn.disabled = true;
            makeWishBtn.innerHTML = `
                <svg class="flower-of-life" viewBox="0 0 200 200">
                    <g class="outer-ring">
                        <circle cx="100" cy="100" r="50" />
                        <circle cx="143.3" cy="125" r="50" />
                        <circle cx="143.3" cy="75" r="50" />
                        <circle cx="100" cy="50" r="50" />
                        <circle cx="56.7" cy="75" r="50" />
                        <circle cx="56.7" cy="125" r="50" />
                    </g>
                    <circle class="center-circle" cx="100" cy="100" r="50" />
                </svg>
                <span class="loading-text">Collapsing 1000 quantum states...</span>
            `;

            // Show sacred geometry backdrop during loading
            const sacredBackdrop = document.getElementById('sacredBackdrop');
            const backdropStartTime = Date.now(); // Track when backdrop was shown
            if (sacredBackdrop) {
                sacredBackdrop.classList.add('show');
                // Create quantum particles emanating from center
                createQuantumParticles();
            }

            let apiData = null;  // Store data to display after backdrop

            try {
                const response = await fetch('/make_wish', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wish, intensity })
                });

                const data = await response.json();

                // Check for limit reached
                if (data.limit_reached) {
                    if (data.show_upsell || data.anonymous) {
                        // For anonymous users, increment wish count and show modal
                        incrementWishCount();
                        showModal();
                    } else {
                        alert(data.error + '\n\nClick OK to view pricing plans.');
                        window.location.href = '#pricing';
                        setTimeout(() => window.scrollTo({
                            top: document.getElementById('pricing').offsetTop - 100,
                            behavior: 'smooth'
                        }), 100);
                    }
                    return;
                }

                // Check for other errors
                if (data.error) {
                    alert(data.error);
                    return;
                }

                // Store data to display AFTER backdrop hiding
                apiData = data;

                // Removed auto-popup modal trigger per team consensus
                // Modal now only shows when user clicks "Make Another Wish" after limit

            } catch (error) {
                console.error('Error:', error);
                // Hide backdrop on error
                const sacredBackdrop = document.getElementById('sacredBackdrop');
                if (sacredBackdrop) {
                    sacredBackdrop.classList.remove('show');
                    sacredBackdrop.style.display = 'none';
                }
                alert('Something went wrong with the quantum field...');
                makeWishBtn.disabled = false;
                makeWishBtn.innerHTML = 'Make Your Wish';
            } finally {
                // Ensure minimum 3.5 second backdrop display, THEN always show results
                if (apiData) {
                    const sacredBackdrop = document.getElementById('sacredBackdrop');
                    const elapsed = Date.now() - backdropStartTime;
                    const remainingTime = Math.max(0, 3500 - elapsed);

                    setTimeout(() => {
                        // CRITICAL: Hide backdrop with both methods
                        if (sacredBackdrop) {
                            sacredBackdrop.classList.remove('show');
                            sacredBackdrop.style.display = 'none';
                        }

                        // Display results - this will also force hide backdrop again
                        displayResults(apiData, wish, intensity);

                        // Increment wish counter for free wish tracking
                        incrementWishCount();

                        // Refresh the recent wishes feed
                        setTimeout(() => fetchRecentWishes(), 1000);

                        // Reset button
                        makeWishBtn.disabled = false;
                        makeWishBtn.innerHTML = 'Make Your Wish';
                    }, remainingTime);
                } else {
                    // No data - just reset
                    makeWishBtn.disabled = false;
                    makeWishBtn.innerHTML = 'Make Your Wish';
                }
            }
        });

        // Generate multiple simulation runs to show "potential futures"
        function generateAlternativeFutures(baseHistogram, numFutures = 5) {
            const futures = [];
            for (let f = 0; f < numFutures; f++) {
                const future = [];
                for (let i = 0; i < baseHistogram.length; i++) {
                    // Add Gaussian noise to create realistic variation
                    const noise = (Math.random() - 0.5) * baseHistogram[i] * 0.4;
                    const value = Math.max(0, baseHistogram[i] + noise);
                    future.push(value);
                }
                futures.push(future);
            }
            return futures;
        }

        // Update consciousness influence meter with simulation results
        function updateConsciousnessMeter(results) {
            const meter = document.getElementById('consciousness-meter');
            const meterFill = document.getElementById('meter-fill');
            const influenceValue = document.getElementById('influence-value');
            const baselineValue = document.getElementById('baseline-value');
            const actualValue = document.getElementById('actual-value');
            const coherenceValue = document.getElementById('coherence-value');

            // Show meter
            meter.style.display = 'block';

            // Calculate influence
            const baseline = 50.0;
            const actual = results.manifested_percent;
            const influence = actual - baseline;

            // Update values with animation delay
            setTimeout(() => {
                // Influence value with color coding
                influenceValue.textContent = (influence >= 0 ? '+' : '') + influence.toFixed(1) + '%';
                influenceValue.style.color = influence >= 0 ? '#a855f7' : '#6b7280';

                baselineValue.textContent = baseline.toFixed(1) + '%';
                actualValue.textContent = actual.toFixed(1) + '%';

                // Fill meter based on result percentage
                const fillPercent = Math.min(Math.max((actual / 100) * 100, 0), 100);
                meterFill.style.width = fillPercent + '%';

                // Display quantum coherence (from backend or calculated)
                const coherenceLabel = results.coherence_label || (actual > 70 ? 'High' : actual > 50 ? 'Medium' : 'Low');
                coherenceValue.textContent = coherenceLabel;
                coherenceValue.style.color = actual > 70 ? '#a855f7' : actual > 50 ? '#ec4899' : '#6b7280';
            }, 200);
        }

        function renderProbabilityGraph(histogram, baseline, userScore) {
            const svg = document.getElementById('prob-graph');

            // Validate inputs
            if (!Array.isArray(histogram) || !Array.isArray(baseline)) {
                console.error('renderProbabilityGraph: histogram and baseline must be arrays');
                return;
            }

            if (histogram.length === 0 || baseline.length === 0) {
                console.error('renderProbabilityGraph: arrays cannot be empty');
                return;
            }

            if (isNaN(userScore) || userScore < 0 || userScore > 100) {
                console.error('renderProbabilityGraph: invalid userScore', userScore);
                return;
            }

            // Clear existing content (except defs)
            const defs = svg.querySelector('defs');
            svg.innerHTML = '';
            svg.appendChild(defs);

            // Graph dimensions with proper margins for dot visualization
            const margin = { left: 38, right: 12, top: 35, bottom: 30 };
            const width = 240 - margin.left - margin.right;
            const height = 140 - margin.top - margin.bottom;
            const graphLeft = margin.left;
            const graphTop = margin.top;
            const graphBottom = margin.top + height;

            // === DOT PLOT VISUALIZATION ===
            // Show individual trials as dots to reveal bimodal distribution
            // Each dot represents one of the 1000 quantum collapse trials

            // 1. AXES (minimal, clean)
            // X-axis
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', graphLeft);
            xAxis.setAttribute('y1', graphBottom);
            xAxis.setAttribute('x2', graphLeft + width);
            xAxis.setAttribute('y2', graphBottom);
            xAxis.setAttribute('stroke', 'rgba(255,255,255,0.3)');
            xAxis.setAttribute('stroke-width', '1');
            svg.appendChild(xAxis);

            // Y-axis
            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', graphLeft);
            yAxis.setAttribute('y1', graphTop);
            yAxis.setAttribute('x2', graphLeft);
            yAxis.setAttribute('y2', graphBottom);
            yAxis.setAttribute('stroke', 'rgba(255,255,255,0.3)');
            yAxis.setAttribute('stroke-width', '1');
            svg.appendChild(yAxis);

            // 2. AXIS LABELS (clear, non-overlapping)
            // X-axis label
            const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xLabel.setAttribute('x', graphLeft + width / 2);
            xLabel.setAttribute('y', graphBottom + 24);
            xLabel.setAttribute('text-anchor', 'middle');
            xLabel.setAttribute('font-size', '8');
            xLabel.setAttribute('fill', 'rgba(255,255,255,0.7)');
            xLabel.setAttribute('font-weight', '500');
            xLabel.textContent = 'Outcome %';
            svg.appendChild(xLabel);

            // Y-axis label
            const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yLabel.setAttribute('x', graphLeft - 6);
            yLabel.setAttribute('y', graphTop - 12);
            yLabel.setAttribute('text-anchor', 'start');
            yLabel.setAttribute('font-size', '8');
            yLabel.setAttribute('fill', 'rgba(255,255,255,0.7)');
            yLabel.setAttribute('font-weight', '500');
            yLabel.textContent = 'Trials';
            svg.appendChild(yLabel);

            // X-axis tick labels (0%, 100% only - these are the only meaningful values for binary quantum collapse)
            const xTicks = [
                { label: '0%', x: graphLeft, value: 0 },
                { label: '100%', x: graphLeft + width, value: 100 }
            ];
            xTicks.forEach(tick => {
                const tickMark = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tickMark.setAttribute('x1', tick.x);
                tickMark.setAttribute('y1', graphBottom);
                tickMark.setAttribute('x2', tick.x);
                tickMark.setAttribute('y2', graphBottom + 4);
                tickMark.setAttribute('stroke', 'rgba(255,255,255,0.4)');
                tickMark.setAttribute('stroke-width', '1.5');
                svg.appendChild(tickMark);

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', tick.x);
                text.setAttribute('y', graphBottom + 13);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '8');
                text.setAttribute('font-weight', '600');
                text.setAttribute('fill', 'rgba(255,255,255,0.8)');
                text.textContent = tick.label;
                svg.appendChild(text);
            });

            // 2.5. MANIFESTATION ZONE HIGHLIGHT (85-100% region)
            // Subtle purple zone showing where consciousness influence peaks
            const manifestZoneStart = 85; // 85%
            const manifestZoneEnd = 100; // 100%
            const zoneX = graphLeft + (manifestZoneStart / 100) * width;
            const zoneWidth = ((manifestZoneEnd - manifestZoneStart) / 100) * width;

            const manifestZone = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            manifestZone.setAttribute('x', zoneX);
            manifestZone.setAttribute('y', graphTop);
            manifestZone.setAttribute('width', zoneWidth);
            manifestZone.setAttribute('height', height);
            manifestZone.setAttribute('fill', 'url(#manifestGradient)');
            manifestZone.setAttribute('opacity', '0.15');
            svg.appendChild(manifestZone);

            // Add gradient definition for manifest zone if not exists
            if (!defs.querySelector('#manifestGradient')) {
                const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
                gradient.setAttribute('id', 'manifestGradient');
                gradient.setAttribute('x1', '0%');
                gradient.setAttribute('y1', '0%');
                gradient.setAttribute('x2', '100%');
                gradient.setAttribute('y2', '0%');

                const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                stop1.setAttribute('offset', '0%');
                stop1.setAttribute('stop-color', '#8B5CF6');

                const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                stop2.setAttribute('offset', '100%');
                stop2.setAttribute('stop-color', '#EC4899');

                gradient.appendChild(stop1);
                gradient.appendChild(stop2);
                defs.appendChild(gradient);
            }

            // 3. DOTS REMOVED - Redundant with histogram (Tufte: chartjunk elimination)
            // Previous dot rendering code commented out to reduce visual noise
            // The histogram bars already show the distribution clearly

            let totalDots = histogram.reduce((sum, count) => sum + count, 0);

            // 4. BASELINE MARKER - Clear vertical line at 50% (Minimal Fix PRD)
            // Replaces floating "Random (50/50)" label with clear reference point
            const baselineX = graphLeft + (50 / 100) * width; // 50% position

            // Draw vertical dashed line at 50%
            const baselineLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            baselineLine.setAttribute('x1', baselineX);
            baselineLine.setAttribute('y1', graphTop);
            baselineLine.setAttribute('x2', baselineX);
            baselineLine.setAttribute('y2', graphBottom);
            baselineLine.setAttribute('stroke', 'rgba(156, 163, 175, 0.6)');
            baselineLine.setAttribute('stroke-width', '2');
            baselineLine.setAttribute('stroke-dasharray', '8,4');
            baselineLine.setAttribute('opacity', '0');
            svg.appendChild(baselineLine);

            // Label at top
            const baselineTopLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            baselineTopLabel.setAttribute('x', baselineX);
            baselineTopLabel.setAttribute('y', graphTop - 6);
            baselineTopLabel.setAttribute('text-anchor', 'middle');
            baselineTopLabel.setAttribute('font-size', '9');
            baselineTopLabel.setAttribute('font-weight', '600');
            baselineTopLabel.setAttribute('fill', 'rgba(156, 163, 175, 0.8)');
            baselineTopLabel.setAttribute('opacity', '0');
            baselineTopLabel.textContent = '50%';
            svg.appendChild(baselineTopLabel);

            // Label at bottom
            const baselineBottomLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            baselineBottomLabel.setAttribute('x', baselineX);
            baselineBottomLabel.setAttribute('y', graphBottom + 13);
            baselineBottomLabel.setAttribute('text-anchor', 'middle');
            baselineBottomLabel.setAttribute('font-size', '8');
            baselineBottomLabel.setAttribute('fill', 'rgba(156, 163, 175, 0.7)');
            baselineBottomLabel.setAttribute('opacity', '0');
            baselineBottomLabel.textContent = 'Baseline';
            svg.appendChild(baselineBottomLabel);

            // Animate baseline marker in
            setTimeout(() => {
                baselineLine.style.transition = 'opacity 0.4s ease-in';
                baselineTopLabel.style.transition = 'opacity 0.4s ease-in';
                baselineBottomLabel.style.transition = 'opacity 0.4s ease-in';
                baselineLine.setAttribute('opacity', '0.8');
                baselineTopLabel.setAttribute('opacity', '1');
                baselineBottomLabel.setAttribute('opacity', '1');
            }, 100);

            // 5. TRIAL COUNT: Show number of trials in compact form
            const titleLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            titleLabel.setAttribute('x', graphLeft + width / 2);
            titleLabel.setAttribute('y', graphTop - 18);
            titleLabel.setAttribute('text-anchor', 'middle');
            titleLabel.setAttribute('font-size', '8');
            titleLabel.setAttribute('font-weight', '600');
            titleLabel.setAttribute('fill', 'rgba(240, 147, 251, 0.8)');
            titleLabel.setAttribute('opacity', '0');
            titleLabel.textContent = `${totalDots} trials`;
            svg.appendChild(titleLabel);

            setTimeout(() => {
                titleLabel.style.transition = 'opacity 0.5s ease-in';
                titleLabel.setAttribute('opacity', '1');
            }, 300);

            // 6. RESULT MARKER - Enhanced with color coding (Minimal Fix PRD Phase 4)
            const markerX = graphLeft + (userScore / 100) * width;

            // Color based on performance (green=good, yellow=moderate, red=poor)
            let resultColor = '#10b981'; // Green for ≥80%
            if (userScore < 80) resultColor = '#f59e0b'; // Yellow for 60-80%
            if (userScore < 60) resultColor = '#ef4444'; // Red for <60%

            // Solid line for result (not dashed - make it stand out)
            const resultLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            resultLine.setAttribute('x1', markerX);
            resultLine.setAttribute('y1', graphTop);
            resultLine.setAttribute('x2', markerX);
            resultLine.setAttribute('y2', graphBottom);
            resultLine.setAttribute('stroke', resultColor);
            resultLine.setAttribute('stroke-width', '3');
            resultLine.setAttribute('opacity', '0');
            svg.appendChild(resultLine);

            // Result value label at top
            const resultTopLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            resultTopLabel.setAttribute('x', markerX);
            resultTopLabel.setAttribute('y', graphTop - 6);
            resultTopLabel.setAttribute('text-anchor', 'middle');
            resultTopLabel.setAttribute('font-size', '9');
            resultTopLabel.setAttribute('font-weight', '700');
            resultTopLabel.setAttribute('fill', resultColor);
            resultTopLabel.setAttribute('opacity', '0');
            resultTopLabel.textContent = `${userScore.toFixed(0)}%`;
            svg.appendChild(resultTopLabel);

            // "Your Result" label at bottom
            const resultBottomLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            resultBottomLabel.setAttribute('x', markerX);
            resultBottomLabel.setAttribute('y', graphBottom + 13);
            resultBottomLabel.setAttribute('text-anchor', 'middle');
            resultBottomLabel.setAttribute('font-size', '8');
            resultBottomLabel.setAttribute('fill', resultColor);
            resultBottomLabel.setAttribute('opacity', '0');
            resultBottomLabel.textContent = 'Your Result';
            svg.appendChild(resultBottomLabel);

            // Animate result marker in
            setTimeout(() => {
                resultLine.style.transition = 'opacity 0.4s ease-in';
                resultTopLabel.style.transition = 'opacity 0.4s ease-in';
                resultBottomLabel.style.transition = 'opacity 0.4s ease-in';
                resultLine.setAttribute('opacity', '1');
                resultTopLabel.setAttribute('opacity', '1');
                resultBottomLabel.setAttribute('opacity', '1');
            }, 500);

            // 7. SHIFT ARROW - Shows transformation from baseline to result (Minimal Fix PRD Phase 5)
            // This is the "journey" visualization that Bret Victor requested
            const shift = userScore - 50; // Calculate shift from 50% baseline

            // Only draw arrow if shift is meaningful (>5%)
            if (Math.abs(shift) >= 5) {
                const arrowY = graphTop + height / 2; // Middle of graph
                const arrowColor = shift > 0 ? '#10b981' : '#ef4444'; // Green for positive, red for negative

                // Arrow shaft (horizontal line from baseline to result)
                const arrowShaft = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                arrowShaft.setAttribute('x1', baselineX);
                arrowShaft.setAttribute('y1', arrowY);
                arrowShaft.setAttribute('x2', markerX);
                arrowShaft.setAttribute('y2', arrowY);
                arrowShaft.setAttribute('stroke', arrowColor);
                arrowShaft.setAttribute('stroke-width', '2.5');
                arrowShaft.setAttribute('opacity', '0');
                svg.appendChild(arrowShaft);

                // Arrowhead (triangle pointing in direction of shift)
                const arrowHead = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const direction = shift > 0 ? 1 : -1;
                const headSize = 8;
                const points = `
                    ${markerX},${arrowY}
                    ${markerX - direction * headSize},${arrowY - headSize / 2}
                    ${markerX - direction * headSize},${arrowY + headSize / 2}
                `;
                arrowHead.setAttribute('points', points.trim());
                arrowHead.setAttribute('fill', arrowColor);
                arrowHead.setAttribute('opacity', '0');
                svg.appendChild(arrowHead);

                // Shift label (shows the amount of shift)
                const shiftLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                const shiftLabelX = (baselineX + markerX) / 2; // Midpoint of arrow
                shiftLabel.setAttribute('x', shiftLabelX);
                shiftLabel.setAttribute('y', arrowY - 10);
                shiftLabel.setAttribute('text-anchor', 'middle');
                shiftLabel.setAttribute('font-size', '9');
                shiftLabel.setAttribute('font-weight', '600');
                shiftLabel.setAttribute('fill', arrowColor);
                shiftLabel.setAttribute('opacity', '0');
                shiftLabel.textContent = `${shift > 0 ? '+' : ''}${shift.toFixed(1)}% shift`;
                svg.appendChild(shiftLabel);

                // Animate arrow in (after result marker)
                setTimeout(() => {
                    arrowShaft.style.transition = 'opacity 0.5s ease-in';
                    arrowHead.style.transition = 'opacity 0.5s ease-in';
                    shiftLabel.style.transition = 'opacity 0.5s ease-in';
                    arrowShaft.setAttribute('opacity', '0.9');
                    arrowHead.setAttribute('opacity', '1');
                    shiftLabel.setAttribute('opacity', '1');
                }, 700);
            }

            // SUMMARY: MINIMAL FIX VISUALIZATION (Expert Committee Approved)
            // Phase 1: ✅ Removed redundant dots (Tufte: eliminate chartjunk)
            // Phase 2: N/A (No histogram bars - using SVG paths)
            // Phase 3: ✅ Added clear baseline marker at 50% (dashed vertical line)
            // Phase 4: ✅ Enhanced result marker with color coding (green/yellow/red)
            // Phase 5: ✅ Added shift arrow showing transformation (Bret Victor's "journey")
            // Phase 6: Pending - Update legend in HTML
            //
            // KEY IMPROVEMENTS:
            // - Clear vertical reference at 50% baseline (not floating label)
            // - Color-coded result marker (green ≥80%, yellow 60-80%, red <60%)
            // - Shift arrow visualizes transformation from baseline → result
            // - No redundant dots obscuring distribution
            // - Clean, understandable in <3 seconds
            //
            // PRESERVED:
            // - Sacred geometry particles in background
            // - Purple/pink mystical color scheme
            // - Quantum physics language
            // - Flower-of-life loading animation
        }


        function displayResults(data, wish, intensity) {
            // CRITICAL: Ensure sacred geometry backdrop is completely removed
            const sacredBackdrop = document.getElementById('sacredBackdrop');
            if (sacredBackdrop) {
                sacredBackdrop.classList.remove('show');
                // Force hide with inline style as failsafe
                sacredBackdrop.style.display = 'none';
            }

            // Show results container
            const container = document.getElementById('results-container');
            if (container) {
                container.classList.add('show');
                container.style.display = 'block'; // Failsafe

                // Scroll into view after a small delay to ensure rendering
                setTimeout(() => {
                    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }

            // === 4-TIER DYNAMIC RESULT MESSAGING ===
            // Uses distribution metrics to provide personalized feedback
            const outcomeMsg = document.getElementById('outcome-message');
            const manifestPercent = data.manifested_percent;
            const peakShift = data.peak_shift || 0;
            const separationScore = data.separation_score || 0;
            const coherenceLabel = data.coherence_label || 'Medium';

            // Store this wish result for paywall messaging
            storeWishResult(manifestPercent);

            // Show result explanation panel (4-tier system)
            const shift = manifestPercent - 50;
            showResultExplanation(manifestPercent, shift, coherenceLabel);

            let message = '';
            let icon = '';

            if (manifestPercent >= 80) {
                // Tier 4: Exceptional consciousness influence (>80%)
                icon = '✨🌟✨';
                const peakType = peakShift > 30 ? 'a dominant 95% peak' : 'strong bimodal distribution';
                message = `<strong>Exceptional consciousness coherence!</strong> Your intention created ${peakType}. ` +
                         `Quantum coherence: <span style="color: #a855f7;">${coherenceLabel}</span>. ` +
                         `This result is ${(manifestPercent - 50).toFixed(1)}% above random chance.`;
            } else if (manifestPercent >= 60) {
                // Tier 3: Measurable influence (60-80%)
                icon = '🌟';
                message = `<strong>Measurable consciousness influence detected.</strong> ` +
                         `Your intention shifted the distribution ${peakShift.toFixed(0)}% from baseline. ` +
                         `Coherence: <span style="color: #ec4899;">${coherenceLabel}</span>. ` +
                         `Continue practicing to strengthen your signal.`;
            } else if (manifestPercent >= 45 && manifestPercent <= 55) {
                // Tier 2: Baseline quantum randomness (45-55%)
                icon = '⚛️';
                message = `<strong>Baseline quantum behavior observed.</strong> ` +
                         `Your results match random chance (50%). ` +
                         `Try increasing your intention intensity or practicing focused meditation before wishing.`;
            } else {
                // Tier 1: Below baseline (<45% or 55-60%)
                icon = '🌙';
                message = `<strong>Subtle consciousness pattern detected.</strong> ` +
                         `The quantum field registered your intention. ` +
                         `Coherence: <span style="color: #6b7280;">${coherenceLabel}</span>. ` +
                         `Manifestation is a practice—consistency builds quantum resonance.`;
            }

            outcomeMsg.innerHTML = `${icon} ${message}`;

            // Display probabilities
            document.getElementById('success-prob').textContent = data.manifested_percent.toFixed(1) + '%';
            document.getElementById('failure-prob').textContent = data.not_manifested_percent.toFixed(1) + '%';

            // Display stats
            const statsGrid = document.getElementById('stats-grid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Trials</div>
                    <div class="stat-value">${data.num_trials}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Success Count</div>
                    <div class="stat-value">${data.manifested_count}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Intention Power</div>
                    <div class="stat-value">${data.intensity}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Baseline Shift</div>
                    <div class="stat-value">${data.difference_from_baseline > 0 ? '+' : ''}${data.difference_from_baseline.toFixed(1)}%</div>
                </div>
            `;

            // Update consciousness influence meter
            updateConsciousnessMeter(data);

            // Render probability distribution graph with error handling
            if (data.trial_histogram && data.baseline_histogram &&
                Array.isArray(data.trial_histogram) && data.trial_histogram.length === 100 &&
                Array.isArray(data.baseline_histogram) && data.baseline_histogram.length === 100) {
                try {
                    renderProbabilityGraph(data.trial_histogram, data.baseline_histogram, data.manifested_percent);
                } catch (error) {
                    console.error('Error rendering probability graph:', error);
                    // Graph fails gracefully - other results still show
                }
            } else {
                console.error('Invalid histogram data:', {
                    trial_histogram: data.trial_histogram ? `array of ${data.trial_histogram.length}` : 'missing',
                    baseline_histogram: data.baseline_histogram ? `array of ${data.baseline_histogram.length}` : 'missing'
                });
            }

            // Update the "Make Another Wish" button state
            checkAndUpdateButtonState();

            // Track wish completion
            trackEvent('wish_completed', {
                manifestation_percentage: data.manifested_percent,
                intensity: intensity,
                coherence: data.coherence_label,
                peak_shift: data.peak_shift,
                wishes_completed: getWishCount()
            });
        }

        // 4-Tier Result Explanation System
        function generateResultExplanation(manifestPercent, shift, coherence) {
            let tier, icon, title, description, action, color;

            if (manifestPercent >= 90) {
                // Tier 4: Exceptional (≥90%)
                tier = 4;
                icon = '✨🌟✨';
                title = 'Exceptional Consciousness Coherence';
                description = `Your intention created a remarkable shift in quantum probability. This result is ${shift.toFixed(1)}% above random chance, suggesting strong consciousness-matter interaction. The bimodal distribution shows clear evidence of observer effect.`;
                action = 'Your consciousness signal is exceptionally strong. Consider documenting this practice and exploring deeper intention-setting techniques.';
                color = '#10b981'; // Green
            } else if (manifestPercent >= 75) {
                // Tier 3: Strong (75-90%)
                tier = 3;
                icon = '🌟';
                title = 'Strong Consciousness Influence';
                description = `Measurable consciousness influence detected. Your wish shifted probability ${shift.toFixed(1)}% from baseline. Quantum coherence is ${coherence.toLowerCase()}, indicating meaningful observer effect.`;
                action = 'You\'re demonstrating consistent influence. Continue practicing to strengthen your consciousness signal further.';
                color = '#a855f7'; // Purple
            } else if (manifestPercent >= 60) {
                // Tier 2.5: Moderate (60-75%)
                tier = 2.5;
                icon = '⚛️';
                title = 'Moderate Consciousness Pattern';
                description = `Your intention shows measurable effect (${shift.toFixed(1)}% above baseline). The distribution reveals emerging patterns beyond random chance.`;
                action = 'You\'re building momentum. Try increasing intention intensity or practicing focused meditation before your next wish.';
                color = '#eab308'; // Yellow
            } else if (manifestPercent >= 45 && manifestPercent <= 59) {
                // Tier 2: Baseline (45-60%)
                tier = 2;
                icon = '🌙';
                title = 'Baseline Quantum Behavior';
                description = `Your result aligns with baseline quantum randomness (around 50%). This is the starting point for most practitioners—consciousness influence takes practice to develop.`;
                action = 'Start with clear, specific intentions. Try the "consciousness warm-up" exercise: visualize your wish for 60 seconds before clicking.';
                color = '#6b7280'; // Gray
            } else {
                // Tier 1: Below baseline (<45%)
                tier = 1;
                icon = '🔮';
                title = 'Subtle Quantum Pattern';
                description = `Your result shows ${Math.abs(shift).toFixed(1)}% variation from baseline. Quantum systems can fluctuate—this is normal variance.`;
                action = 'No worry—consciousness influence strengthens with practice. Focus on emotional clarity and specific visualization.';
                color = '#6b7280'; // Gray
            }

            return { tier, icon, title, description, action, color };
        }

        function showResultExplanation(manifestPercent, shift, coherence) {
            const explanation = generateResultExplanation(manifestPercent, shift, coherence);

            // Populate DOM elements
            document.getElementById('explanation-icon').textContent = explanation.icon;
            document.getElementById('explanation-title').textContent = explanation.title;
            document.getElementById('explanation-description').textContent = explanation.description;
            document.getElementById('result-value').textContent = `${manifestPercent.toFixed(0)}%`;

            const shiftText = shift >= 0 ? `+${shift.toFixed(1)}%` : `${shift.toFixed(1)}%`;
            document.getElementById('shift-value').textContent = shiftText;

            document.getElementById('explanation-action').innerHTML = `<strong>Next Step:</strong> ${explanation.action}`;

            // Apply color theme
            const panel = document.getElementById('explanation-panel');
            panel.style.borderLeftColor = explanation.color;
            panel.style.display = 'block';
        }

        function resetWish() {
            // Check if anonymous user has reached their wish limit (3 wishes)
            if (hasReachedWishLimit()) {
                showModal();
                return;
            }

            resultsContainer.classList.remove('show');
            wishText.value = '';
            intensitySlider.value = 1;
            intensitySlider.dataset.actualValue = 1;
            intensityValue.textContent = '1%';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update "Make Another Wish" button appearance based on usage
        function updateMakeAnotherWishButton() {
            const wishAgainBtn = document.querySelector('.wish-again-btn');
            if (wishAgainBtn && hasReachedWishLimit()) {
                wishAgainBtn.classList.add('disabled');
                wishAgainBtn.textContent = 'Get More Wishes';
            }
        }

        // Call this when results are displayed
        function checkAndUpdateButtonState() {
            updateMakeAnotherWishButton();
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Modal functions
        function showModal(trigger = 'default') {
            // Allow modal to show once after wish AND once by scroll
            if (trigger === 'afterWish' && modalShownAfterWish) {
                return;
            }
            if (trigger === 'scroll' && modalShownByScroll) {
                return;
            }

            // Mark the appropriate flag
            if (trigger === 'afterWish') {
                modalShownAfterWish = true;
            } else if (trigger === 'scroll') {
                modalShownByScroll = true;
            }

            // === ENHANCED PAYWALL MESSAGING ===
            // Personalize based on user's wish results
            const lastResult = getLastWishResult();
            const averageShift = calculateAverageShift();
            const wishCount = getWishCount();

            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalStats = document.getElementById('modalStats');

            // Context-aware title
            if (lastResult !== null && lastResult >= 80) {
                modalTitle.textContent = `Incredible! You hit ${lastResult.toFixed(0)}%`;
            } else if (wishCount === 1) {
                modalTitle.textContent = 'Your free wish is complete';
            } else {
                modalTitle.textContent = 'Continue the Practice?';
            }

            // Context-aware subtitle
            if (averageShift !== null) {
                const shiftText = averageShift >= 0 ? `+${averageShift.toFixed(1)}%` : `${averageShift.toFixed(1)}%`;
                modalSubtitle.textContent = `Your wish shifted probability ${shiftText} from baseline. Keep going to strengthen your consciousness signal—or unlock unlimited wishes.`;

                // Show stats
                modalStats.textContent = `📊 Your result: ${(50 + averageShift).toFixed(0)}% manifestation (${wishCount}/1 wish used)`;
                modalStats.style.display = 'block';
            } else {
                modalSubtitle.textContent = 'Each wish matters. No infinite scrolling, no ambient noise—just intentional focus. Try one more for a quarter, or join the practice with 10 curated wishes per month.';
                modalStats.style.display = 'none';
            }

            const modal = document.getElementById('upsellModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';  // Prevent scrolling

            // Track paywall shown
            trackEvent('paywall_shown', {
                trigger: trigger,
                wish_count: wishCount,
                last_result: lastResult,
                average_shift: averageShift,
                has_personalized_message: averageShift !== null
            });
        }

        function closeModal() {
            const modal = document.getElementById('upsellModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';  // Restore scrolling
        }

        // Close modal when clicking outside
        document.getElementById('upsellModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Email subscription function for main signup bar
        async function handleEmailSignup(event) {
            event.preventDefault();

            const emailInput = document.getElementById('main-email-input');
            const messageDiv = document.getElementById('main-email-message');
            const email = emailInput.value.trim();

            if (!email) {
                messageDiv.style.display = 'block';
                messageDiv.style.color = 'rgba(245, 87, 108, 0.9)';
                messageDiv.textContent = 'Please enter your email';
                return;
            }

            try {
                const response = await fetch('/api/subscribe-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        source: 'main_email_bar'
                    })
                });

                const data = await response.json();

                messageDiv.style.display = 'block';
                if (response.ok) {
                    messageDiv.style.color = 'rgba(144, 238, 144, 0.9)';
                    messageDiv.textContent = data.message || 'Success! Check your inbox soon.';
                    emailInput.value = '';
                } else {
                    messageDiv.style.color = 'rgba(245, 87, 108, 0.9)';
                    messageDiv.textContent = data.error || 'Something went wrong. Please try again.';
                }
            } catch (error) {
                console.error('Error subscribing email:', error);
                messageDiv.style.display = 'block';
                messageDiv.style.color = 'rgba(245, 87, 108, 0.9)';
                messageDiv.textContent = 'Network error. Please try again.';
            }
        }

        // Email subscription function for modal
        async function subscribeEmail() {
            const emailInput = document.getElementById('email-subscribe-input');
            const messageDiv = document.getElementById('email-subscribe-message');
            const email = emailInput.value.trim();

            if (!email) {
                messageDiv.style.display = 'block';
                messageDiv.style.color = 'rgba(245, 87, 108, 0.9)';
                messageDiv.textContent = 'Please enter your email';
                return;
            }

            try {
                const response = await fetch('/api/subscribe-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        source: 'post_wish_modal'
                    })
                });

                const data = await response.json();

                messageDiv.style.display = 'block';
                if (response.ok) {
                    messageDiv.style.color = 'rgba(144, 238, 144, 0.9)';
                    messageDiv.textContent = data.message || 'Success! Check your inbox soon.';
                    emailInput.value = '';
                } else {
                    messageDiv.style.color = 'rgba(245, 87, 108, 0.9)';
                    messageDiv.textContent = data.error || 'Something went wrong. Please try again.';
                }
            } catch (error) {
                console.error('Error subscribing email:', error);
                messageDiv.style.display = 'block';
                messageDiv.style.color = 'rgba(245, 87, 108, 0.9)';
                messageDiv.textContent = 'Network error. Please try again.';
            }
        }

        // Removed scroll-triggered modal per team consensus
        // It was interrupting users while reading "How It Works" section
        // Modal now only shows when user clicks "Make Another Wish" after limit

        // Recent Wishes Feed
        async function fetchRecentWishes() {
            try {
                const response = await fetch('/api/recent-wishes');
                const wishes = await response.json();

                const feedContainer = document.getElementById('wish-feed');

                if (!wishes || wishes.length === 0) {
                    feedContainer.innerHTML = '<div class="wish-feed-loading">No recent wishes yet. Be the first!</div>';
                    return;
                }

                feedContainer.innerHTML = wishes.map(wish => `
                    <div class="wish-feed-item">
                        <div class="wish-feed-header">
                            <span class="wish-feed-time">${wish.time_ago}</span>
                            <span class="wish-feed-percent">${wish.manifested_percent}% manifested</span>
                        </div>
                        <div class="wish-feed-text">"${wish.wish}"</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error fetching recent wishes:', error);
                document.getElementById('wish-feed').innerHTML =
                    '<div class="wish-feed-loading">Unable to load recent wishes</div>';
            }
        }

        // Load recent wishes on page load
        fetchRecentWishes();

        // Auto-refresh every 30 seconds
        setInterval(fetchRecentWishes, 30000);

        // === STICKY MOBILE CTA ===
        // Show/hide sticky CTA based on scroll position (mobile only)
        function scrollToWishInput() {
            const wishInput = document.getElementById('wish-text');
            if (wishInput) {
                wishInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Focus after scroll completes
                setTimeout(() => wishInput.focus(), 500);
                trackEvent('sticky_cta_clicked');
            }
        }

        function handleStickyCTA() {
            const stickyCTA = document.getElementById('stickyCTA');
            const wishInput = document.getElementById('wish-text');

            if (window.innerWidth > 768 || !stickyCTA || !wishInput) return;

            const wishInputRect = wishInput.getBoundingClientRect();
            const scrollY = window.scrollY || window.pageYOffset;

            // Show CTA when user has scrolled past the wish input (300px buffer)
            if (scrollY > 300 && wishInputRect.bottom < 0) {
                stickyCTA.style.display = 'block';
            } else {
                stickyCTA.style.display = 'none';
            }
        }

        // Handle sticky CTA on scroll (throttled for performance)
        let stickyCtaTimeout;
        window.addEventListener('scroll', () => {
            if (stickyCtaTimeout) return;
            stickyCtaTimeout = setTimeout(() => {
                handleStickyCTA();
                stickyCtaTimeout = null;
            }, 100);
        }, { passive: true });

        // Check on load and resize
        window.addEventListener('load', handleStickyCTA);
        window.addEventListener('resize', handleStickyCTA);
    </script>
</body>
</html>
